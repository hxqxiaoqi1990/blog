---
title: ssh端口转发
tags: [ssh]
categories: linux基础
date: 2019-10-27 21:49:00
---

# 介绍
ssh端口转发作用：

 1. 转发对应的端口请求到目标服务器的对应端口服务（在本地生成监听端口）
 2. 转发对应的端口请求到目标服务器的对应端口服务（在跳板机生成监听端口）

# 使用
**ssh参数说明：**

 1. -L	# 本地转发
 2. -R	# 远程转发
 3. -N	# 不打开远程shell，处于等待状态（不加-N则直接登录进去
 4. -f	# 后台启用

**实验环境：**

 1. 192.168.40.100（发起请求）
 2. 192.168.40.101（跳板机）
 3. 192.168.40.102（被请求）

## 在本地生成监听端口

执行该命令，在192.168.40.100上会生成3000端口的监听，访问该端口等于访问192.168.40.102上的22端口服务，使用ssh连接192.168.40.100并指定端口为3000，最终需要输入的是192.168.40.102服务器的密码。

192.168.40.100实际是通过访问192.168.40.102上的22端口服务。

192.168.40.101类似与跳板机作用。

实际环境，192.168.40.101应该是公网IP，并可以被192.168.40.101访问，且能访问192.168.40.102。
``` bash
# 在192.168.40.100上执行，并要求输入101的密码
ssh -L 192.168.40.100:3000:192.168.40.102:22 -N 192.168.40.101
```

## 在跳板机生成监听端口

执行该命令，在192.168.40.101上会生成3000端口的监听，访问该端口等于访问192.168.40.102上的22端口服务，使用ssh连接192.168.40.100并指定端口为3000，最终需要输入的是192.168.40.102服务器的密码。
注：192.168.40.101会以127.0.0.1监听，所以只能登录到该服务器访问。

``` bash
# 在192.168.40.100上执行，并要求输入101的密码
ssh -R 192.168.40.100:3000:192.168.40.102:22 -N 192.168.40.101
```